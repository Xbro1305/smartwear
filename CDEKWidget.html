<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@cdek-it/widget@3" charset="utf-8"></script>
</head>
<body>
    <div id="cdek-map" style="width:800px; height:600px"></div>
</body>
<script type="text/javascript" charset="utf-8">
  document.addEventListener('DOMContentLoaded', () => {
    new window.CDEKWidget({
      root: 'cdek-map',
      servicePath: 'https://test.maxiscomfort.ru/api/cdek',
      from: 'Москва',
      apiKey: '7a6984be-b5f1-4336-b45b-ffca60db56d6',
      defaultLocation: 'Москва',
      onChoose: async (point) => {
        console.log('Выбранный ПВЗ:', point);
        try {
          const response = await fetch('https://test.maxiscomfort.ru/api/cdek/save-pvz', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('token') },
            body: JSON.stringify({ fullAddress: point.address }),
          });
          if (!response.ok) throw new Error('Ошибка при сохранении адреса');
          alert('Адрес сохранен!');
        } catch (error) {
          console.error('Ошибка:', error);
        }
      },
    });
  });
</script>
</html>